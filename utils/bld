#! /bin/bash

## BUILD SCRIPT ##
## Given an option, build the executable and distribute the script across the 
## cluster
##	--Most commonly used have abbreviated opts but full make command can 
##	  be provided
##	--If adding another option to case, should correspond with option in 
##	  b+r to build and run benchmark
##	Note: File could definitely be cleaned up...

cd $( dirname $0 )/../build

function header {
	echo -e "\e[33;1m######## ${1} ########\e[0m"
}

case $1 in
	"agg")
		make clean; make -s mode=debug aggregate

		if [ $? -eq 0 ]; then 
			cd ..
			./utils/send_file build/aggregate.bin
		else 
			return 13
		fi
		;;
	*)
		make clean; make -s mode=debug aggregate

		if [ $? -eq 0 ]; then 
			cd ..
			./utils/send_file build/aggregate.bin
		else 
			return 13
		fi
		;;
esac

header "Successfully built benchmark ${1}"
