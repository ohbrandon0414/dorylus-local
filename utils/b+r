#! /bin/bash

## BUILD AND RUN ##
## Calls the build script for a specific benchmark, distributes the 
## executable to the cluster, then runs it with the specified BM
## 	--The option provided needs to correspond to options in the
##	  build and run scripts

#
# Usage: ./b+r [Bench] [Dataset] [Feature-File]
#
#   Bench:          agg(*)
#   Dataset:        small(*), fb
#   Feature-File:   (*), path_to_file 
#
# "(*)" means default.
#

cd $( dirname $0 )

function header {
	echo -e "\e[32;1m######## ${1} ########\e[0m"
}

function prompt {
    echo -e "\e[33;1m${1}\e[0m"
}


header "BUILDING the engine & benchmark"

./bld $1

if [ $? -ne 0 ]; then
	exit
fi

case $1 in
    "agg")
        prompt "Successfully built benchmark \"agg\"."
        ;;
    *)
        prompt "Successfully built the default benchmark (\"agg\")."
        ;;
esac


header "RUNNING the benchmark on dataset"

case $2 in
    "small")
        prompt "Running on dataset \"small\"."
        ;;
    "fb")
        prompt "Running on dataset \"fb\"."
        ;;
    *)
        prompt "Running on the default dataset (\"small\")."
        ;;
esac

cd ..
./run/ec2run.sh $1 $2 $3
        