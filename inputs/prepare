#!/bin/bash

#
# Convert a text graph into binary, and partite it into partitions.
#

if [ ! $# == 4 ]; then
    echo "Usage: $0 <graph-file> <undirected? (0/1)> <num-vertices> <num-partitions>";
    exit;
fi

rm -rf data && mkdir data

function header {
    echo -e "\e[33;1m######## ${1} ########\e[0m"
}

GRAPH=$1;
UNDIRECTED=$2;
VERTICES=$3;
PARTS=$4;

header "Converting to binary..."

./tobinary ${GRAPH} --snapfile=${GRAPH} --undirected=${UNDIRECTED} --header=1

BSNAP=${GRAPH}.bsnap
mv ${BSNAP} .
BSNAP=$( basename ${BSNAP} )

header "Conduct partitioning..."

./partitioner ${BSNAP} ${VERTICES} ${PARTS}

ln -s ${BSNAP} parts_${PARTS}/${BSNAP}.edges

mv parts_${PARTS} data/
mv ${BSNAP} data/
